# hadolint ignore=DL3007
# Stage 1: Builder (not strictly necessary for static files, but shows the concept)
FROM node:20-alpine AS builder

WORKDIR /app
COPY index.html .

# Stage 2: Runner
# Use a minimal, security-oriented base image like Nginx-alpine
FROM nginx:alpine

# Copy the built assets from the builder stage to the Nginx serving directory
COPY --from=builder /app/index.html /usr/share/nginx/html/index.html

# Security Best Practice: Run as a non-root user
# Fix permissions to run as non-root
RUN chown -R nginx:nginx /var/cache/nginx /var/log/nginx /etc/nginx/conf.d /usr/share/nginx/html && \
    touch /var/run/nginx.pid && \
    chown -R nginx:nginx /var/run/nginx.pid

# Healthcheck (CIS-DI-0006)
HEALTHCHECK --interval=30s --timeout=5s --start-period=5s --retries=3 \
    CMD wget -q --spider http://localhost:80/ || exit 1

# Run as non-root (CIS-DI-0001)
USER nginx

# Expose port 80 for the web traffic
EXPOSE 80

# Command to run Nginx (default in Nginx images)
CMD ["nginx", "-g", "daemon off;"]
